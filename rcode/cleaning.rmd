##  Dataset flow
##      cpu-raw.csv ---importing.r---> cpu-short.csv ---cleaning.r---> cpu-clean.csv
```{r}

pacman::p_load(
  rio,     # for imports & exports
  ggplot2, # for plots
  zoo      # for year-quarter formats
  )

setwd("/Users/admin/Desktop/_probability_PROJECT/btlprob/rcode")  # set working directory
data <- import("cpu-short.csv")        # rio::import

data[,"ldate"] <- (
  as.yearqtr(data[,"ldate"], format = "Q%q'%y")
)

data[,"litho"] <- as.numeric(
  gsub(" nm", "", data[,"litho"])
)

data[,"rprice"] <- gsub(
  "(^\\$(\\d)+.(\\d)+ - )", 
  "", 
  data[,"rprice"]
  )

data$rprice <- ifelse(data$rprice == "N/A", NA, data$rprice)

data$rprice <- as.numeric(gsub('\\$|,', '', data$rprice))

data[,"bfreq"] <- as.numeric(
  gsub("( GHz)|( MHz)", "", data[,"bfreq"])
)
data<- data[!is.na(data$bfreq), ]   # Truncate NAs because subscripting with NA
                                    # is not allowed.
data$bfreq[data$bfreq > 10] <- data$bfreq[data$bfreq > 10]*0.001

data[,"tdp"] <- as.numeric(
  gsub(" W", "", data[,"tdp"])
)

#     perl=TRUE to enable extended Regex feature
#     
#     First, we match ony the decimal numbers, and separate them by comma,
#     (all characters unrelated to a specific decimal number are forced to become
#     comma)
#     Second, we use 'strsplit' to separate the numbers, with the delimeter is ","
#     by doing that, we have a list, with each entry of that list contains multiple values
#     Third, for each entry 'for (i in seq_along(...))' of that list, we keep only the maximum 
#     numeric value among the elements of the same entry. Entries with no valid numerics are
#     treated as NAs.
data[,"temp"] <- (gsub("[^0-9.\\-]+", ",", data[,"temp"]))  # 
for (i in seq_along(data[["temp"]])) {                    # For each elements in the same entry
  temp_values <- strsplit(data[i, "temp"], ",")           # Split into a list of words
  temp_values <- unlist(lapply(temp_values, as.numeric))  # Transform them into equivalent numerics
  max_value <- max(temp_values, na.rm = TRUE)             # Find max
  if (is.infinite(max_value)) {                           # Is it an invalid numeric?
    max_value <- NA
  }
  data[i, "temp"] <- max_value                            # Store the maximum value
}

export(data, "cpu-clean.csv")

# Dont pay attention to the warnings.
```